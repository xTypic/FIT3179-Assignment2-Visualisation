{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": "container",
  "height": 280,
  "data": {"url": "palm_oil_production_multi_year.csv"},
  "params": [
    {
      "name": "year_select",
      "value": 2022,
      "bind": {
        "input": "select",
        "options": [2018, 2019, 2020, 2021, 2022],
        "labels": ["2018", "2019", "2020", "2021", "2022"],
        "name": "Select Year: "
      }
    }
  ],
  "transform": [
    {"filter": "datum.production_tonnes > 0 && datum.year == year_select"},
    {"calculate": "datum.production_tonnes / 1000000", "as": "production_millions"}
  ],
  "layer": [
    {
      "mark": {
        "type": "bar",
        "cornerRadiusEnd": 4
      },
      "encoding": {
        "y": {
          "field": "state",
          "type": "nominal",
          "title": null,
          "sort": "-x",
          "axis": {"labelFontSize": 11, "labelFontWeight": "bold", "labelPadding": 8}
        },
        "x": {
          "field": "production_tonnes",
          "type": "quantitative",
          "title": "Production (millions of tonnes)",
          "axis": {
            "format": ".1f",
            "labelExpr": "datum.value / 1000000",
            "labelFontSize": 10,
            "titleFontSize": 12,
            "grid": false
          }
        },
        "color": {
          "field": "production_tonnes",
          "type": "quantitative",
          "scale": {"scheme": "blues"},
          "legend": null
        },
        "tooltip": [
          {"field": "state", "type": "nominal", "title": "State"},
          {"field": "year", "type": "ordinal", "title": "Year"},
          {"field": "production_tonnes", "type": "quantitative", "title": "Production (tonnes)", "format": ","}
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "right",
        "baseline": "middle",
        "dx": -8,
        "color": "white",
        "fontWeight": "bold",
        "fontSize": 12
      },
      "encoding": {
        "y": {
          "field": "state",
          "type": "nominal",
          "sort": "-x"
        },
        "x": {
          "field": "production_tonnes",
          "type": "quantitative"
        },
        "text": {
          "field": "production_millions",
          "type": "quantitative",
          "format": ".2f"
        }
      }
    }
  ]
}